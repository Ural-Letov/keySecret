{% extends "base.html" %}

{% block title %}–ú–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∏ - keySecret{% endblock %}

{% block content %}
<div class="master-keys-page">
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-key"></i>
            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∞–º–∏
        </h1>
        <p class="page-subtitle">–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–æ–º –∫ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º</p>
    </div>

    <div class="keys-section">
        <!-- –í–∞—à –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á -->
        <div class="key-card">
            <div class="key-header">
                <h3>
                    <i class="fas fa-lock"></i>
                    –í–∞—à –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á
                </h3>
            </div>
            <div class="key-content">
                <div class="key-display">
                    <input type="text" value="{{ master_key }}" readonly class="key-input">
                    <button class="btn btn-primary btn-small" onclick="copyMasterKey()">
                        <i class="fas fa-copy"></i>
                        –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- –û–±—â–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∏ -->
        <div class="shared-keys-section">
            <div class="section-header">
                <h3>
                    <i class="fas fa-share-alt"></i>
                    –û–±—â–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∏
                </h3>
                <a href="{{ url_for('share_key') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–ª—é—á
                </a>
            </div>

            <div class="shared-keys-list">
                {% if shared_keys %}
                    {% for key_data in shared_keys %}
                    <div class="shared-key-card">
                        <div class="key-info">
                            <div class="key-user">
                                <i class="fas fa-user"></i>
                                {{ key_data[0] }}
                            </div>
                            <div class="key-status {{ 'accepted' if key_data[2] == 'accepted' else 'pending' }}">
                                {% if key_data[2] == 'accepted' %}
                                    <i class="fas fa-check-circle"></i>
                                    –ü—Ä–∏–Ω—è—Ç
                                {% else %}
                                    <i class="fas fa-clock"></i>
                                    –û–∂–∏–¥–∞–µ—Ç
                                {% endif %}
                            </div>
                        </div>
                        <div class="key-details">
                            <div class="key-value">
                                <strong>–ö–ª—é—á:</strong> {{ key_data[1] }}
                            </div>
                            {% if key_data[2] == 'accepted' %}
                            <div class="key-actions">
                                <button class="btn btn-primary btn-small" onclick="copySharedKey('{{ key_data[1] }}')">
                                    <i class="fas fa-copy"></i>
                                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-keys">
                        <i class="fas fa-info-circle"></i>
                        <span>–ù–µ—Ç –æ–±—â–∏—Ö –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–µ–π</span>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function copyMasterKey() {
    const masterKey = '{{ master_key }}';
    navigator.clipboard.writeText(masterKey).then(() => {
        alert('üìã –ú–∞—Å—Ç–µ—Ä-–∫–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    }).catch(() => {
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–ª—é—á–∞');
    });
}

function copySharedKey(key) {
    navigator.clipboard.writeText(key).then(() => {
        alert('üìã –ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    }).catch(() => {
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–ª—é—á–∞');
    });
}
</script>
{% endblock %}
